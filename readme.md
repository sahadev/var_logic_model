# 面向变量聚合的逻辑建模工具

一个基于 LiteGraph.js 构建的可视化逻辑建模和仿真工具，支持通过节点图的方式构建复杂的逻辑关系模型。

## 📋 目录

- [项目简介](#项目简介)
- [功能特性](#功能特性)
- [技术栈](#技术栈)
- [快速开始](#快速开始)
- [项目结构](#项目结构)
- [核心功能](#核心功能)
- [节点类型](#节点类型)
- [数据管理](#数据管理)
- [部署信息](#部署信息)

## 🎯 项目简介

本项目是一个基于浏览器的可视化逻辑建模工具，允许用户通过拖拽节点的方式构建复杂的逻辑关系图。系统支持实时仿真、数据持久化存储、以及灵活的导入导出功能。

## ✨ 功能特性

### 1. 可视化节点编辑
- 基于 LiteGraph.js 的强大节点图编辑器
- 支持拖拽、缩放、平移等交互操作
- 实时连接节点构建逻辑关系
- 网格对齐和自动布局

### 2. 逻辑仿真
- 一键启动/停止仿真
- 实时计算节点输出
- 支持复杂逻辑链路的执行

### 3. 数据管理
- **本地存储**：数据保存到 localStorage
- **IndexedDB 存储**：支持大量数据记录存储
- **数据记录列表**：左侧面板显示所有保存的记录
  - 显示保存时间（智能相对时间显示）
  - 支持编辑记录标题
  - 一键快速导入历史记录
  - 支持删除记录

### 4. 导入导出
- **复制到剪贴板**：一键复制当前图表数据（JSON 格式）
- **粘贴导入**：从剪贴板粘贴 JSON 数据并导入
- **序列化保存**：保存到本地存储和 IndexedDB
- **从本地存储加载**：快速加载最近保存的数据

### 5. 用户界面
- 现代化的 UI 设计（基于 Mantine UI）
- 美化的按钮样式，不同功能使用不同颜色区分
- 响应式布局设计
- 友好的错误提示和成功通知

## 🛠 技术栈

- **前端框架**: React 18.3.1
- **UI 组件库**: Mantine 7.11.1
- **图形引擎**: LiteGraph.js
- **样式**: Tailwind CSS 3.4.4
- **状态管理**: Zustand 4.5.4
- **数据存储**: IndexedDB, localStorage
- **构建工具**: React Scripts 5.0.1
- **语言**: TypeScript

## 🚀 快速开始

### 环境要求

- Node.js >= 14.0.0
- npm 或 yarn

### 安装依赖

```bash
# 使用 yarn（推荐）
yarn install

# 或使用 npm
npm install
```

### 启动开发服务器

```bash
cd packages/main-package
npm run start
```

项目将在 `http://localhost:3000` 启动。

### 构建生产版本

```bash
cd packages/main-package
npm run build
```

## 📁 项目结构

```
use-lite-graph/
├── packages/
│   ├── main-package/          # 主应用包
│   │   ├── src/
│   │   │   ├── components/    # React 组件
│   │   │   │   ├── Serialize.tsx          # 序列化控制组件
│   │   │   │   ├── DataRecordList.tsx     # 数据记录列表
│   │   │   │   └── ModifyModal.tsx        # 修改模态框
│   │   │   ├── extends/       # 扩展功能
│   │   │   │   ├── Graph.ts              # 图表实例管理
│   │   │   │   ├── Demo.ts               # 示例节点定义
│   │   │   │   ├── nodes/                # 自定义节点
│   │   │   │   │   ├── RawDefineNode.ts      # 原始定义节点
│   │   │   │   │   ├── EqualAssertNode.ts    # 断言节点
│   │   │   │   │   ├── AndOperateNode.ts     # 与操作节点
│   │   │   │   │   ├── OrOperateNode.ts      # 或操作节点
│   │   │   │   │   ├── OutputNode.ts         # 输出节点
│   │   │   │   │   └── MultiOutputNode.ts    # 多输出节点
│   │   │   │   └── App.tsx               # 主应用组件
│   │   │   ├── LiteGraph/     # LiteGraph 核心库
│   │   │   ├── utils/         # 工具函数
│   │   │   │   └── indexedDB.ts          # IndexedDB 管理
│   │   │   └── store/         # 状态管理
│   │   └── public/            # 静态资源
│   └── litegraph.js/          # LiteGraph 库源码
├── package.json
└── readme.md
```

## 🎨 核心功能

### 节点图编辑

在画布上可以：
- 右键点击创建新节点
- 拖拽节点调整位置
- 连接节点的输入输出端口
- 双击节点编辑属性
- 使用滚轮缩放画布
- 拖拽画布平移视图

### 数据序列化

所有图表数据可以序列化为 JSON 格式，包含：
- 节点信息（位置、属性、连接）
- 链接关系
- 配置信息
- 版本信息

### 数据记录管理

左侧数据记录列表提供：
- **自动保存**：点击"保存到LS及DB"时自动添加到记录列表
- **时间显示**：智能显示相对时间（刚刚、X分钟前、X小时前等）
- **标题编辑**：点击编辑图标可修改记录标题
- **快速导入**：点击记录项即可导入到画布
- **删除记录**：支持删除不需要的记录

## 🔧 节点类型

### 1. RawDefineNode（原始定义节点）
- **功能**：定义原始变量值
- **输入**：无
- **输出**：变量值（数字或布尔值）
- **属性**：可设置数值、精度、步长等

### 2. EqualAssertNode（断言节点）
- **功能**：执行条件断言，判断输入是否满足表达式
- **输入**：变量值
- **输出**：布尔值（true/false）
- **属性**：可编辑表达式（使用 `input` 代表输入变量）

### 3. AndOperateNode（与操作节点）
- **功能**：执行逻辑与操作
- **输入**：多个布尔值
- **输出**：所有输入的逻辑与结果

### 4. OrOperateNode（或操作节点）
- **功能**：执行逻辑或操作
- **输入**：多个布尔值
- **输出**：所有输入的逻辑或结果

### 5. OutputNode（输出节点）
- **功能**：输出最终结果
- **输入**：计算结果
- **输出**：显示在节点上

### 6. MultiOutputNode（多输出节点）
- **功能**：支持多个输出端口
- **输入**：多个输入值
- **输出**：多个输出值

## 💾 数据管理

### 保存数据

点击"保存到LS及DB"按钮：
1. 数据保存到 localStorage（键名：`litegrapheditor_clipboard`）
2. 数据同时保存到 IndexedDB
3. 自动添加到左侧数据记录列表
4. 显示保存成功通知

### 加载数据

**方式一：从本地存储加载**
- 点击"从LS加载"按钮
- 加载最近保存到 localStorage 的数据

**方式二：从记录列表导入**
- 在左侧记录列表中点击任意记录
- 自动导入到画布

**方式三：粘贴导入**
- 点击"导入"按钮
- 在弹窗中粘贴 JSON 数据
- 点击"导入"完成加载

### 导出数据

**复制到剪贴板**
- 点击"复制"按钮
- 当前图表数据以格式化的 JSON 复制到剪贴板
- 可以粘贴到其他应用或保存为文件

## 🎮 操作指南

### 基本操作

1. **创建节点**：右键点击画布，选择节点类型
2. **连接节点**：从输出端口拖拽到输入端口
3. **编辑节点**：双击节点打开编辑面板
4. **删除节点**：选中节点后按 Delete 键
5. **移动节点**：拖拽节点到新位置

### 仿真操作

1. **开始仿真**：点击"▶ 开始仿真"按钮
2. **停止仿真**：点击"⏹ 停止仿真"按钮
3. 仿真过程中节点会实时计算并更新输出

### 数据操作

1. **保存**：点击"💾 保存到LS及DB"
2. **加载**：点击"📂 从LS加载"或从记录列表选择
3. **复制**：点击"📋 复制"复制到剪贴板
4. **导入**：点击"📥 导入"粘贴 JSON 数据
5. **加载示例**：点击"🎯 加载Demo"加载示例节点

## 🌐 部署信息

项目已部署至：[http://var_logic_model.surge.sh](http://var_logic_model.surge.sh)

### 本地部署

```bash
cd packages/main-package
npm run build
# 构建产物在 build/ 目录
```

## 📝 开发说明

### 添加新节点类型

1. 在 `src/extends/nodes/` 目录创建新节点文件
2. 继承 `LGraphNode` 类
3. 实现节点的输入输出和计算逻辑
4. 在 `src/extends/Graph.ts` 中注册节点类型
5. 在 `src/extends/Demo.ts` 中添加示例（可选）

### 自定义样式

项目使用 Tailwind CSS，可以在组件中使用 Tailwind 类名。全局样式在 `src/extends/App.css` 中定义。

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📄 许可证

本项目基于 LiteGraph.js 构建，请参考相关许可证文件。

---

**注意**：本项目代码位于 `packages/main-package` 目录下。
